name: Build Preview App

on:
  workflow_dispatch:
    inputs:
      platform:
        description: 'Platform to build'
        required: true
        default: 'all' # ios, android, ou all

jobs:
  build-preview:
    runs-on: ubuntu-latest

    steps:
      # 1Ô∏è‚É£ Checkout code
      - uses: actions/checkout@v3

      # 2Ô∏è‚É£ Installer Node & d√©pendances
      - name: Set up Node.js
        uses: actions/setup-node@v3
        with:
          node-version: 20

      - name: Install dependencies
        run: npm install

      # 3Ô∏è‚É£ Installer Expo CLI et EAS CLI
      - name: Install Expo CLI
        run: npm install -g expo-cli eas-cli

      # 4Ô∏è‚É£ Build Preview
      - name: Build Preview App
        run: |
          if [ "${{ github.event.inputs.platform }}" = "ios" ]; then
            echo "üîÑ Building iOS preview..."
            eas build --platform ios --profile preview --non-interactive
            echo "‚úÖ iOS preview built"
          elif [ "${{ github.event.inputs.platform }}" = "android" ]; then
            echo "üîÑ Building Android preview..."
            eas build --platform android --profile preview --non-interactive
            echo "‚úÖ Android preview built"
          else
            echo "üîÑ Building both iOS and Android previews..."
            eas build --platform ios --profile preview --non-interactive
            echo "‚úÖ iOS preview built"
            eas build --platform android --profile preview --non-interactive
            echo "‚úÖ Android preview built"
            echo "‚úÖ Both iOS and Android previews built"
          fi
        env:
          EXPO_TOKEN: ${{ secrets.EXPO_TOKEN }}
          APP_STORE_CONNECT_API_KEY: ${{ secrets.APP_STORE_CONNECT_API_KEY }}
